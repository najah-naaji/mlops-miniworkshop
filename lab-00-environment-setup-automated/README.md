# MLOps labs environment.

The labs in this repo are designed to run in a simplified MLOps environment. 

![Reference topolgy](/images/lab-env.png)

The core services in the environment are:
- **AI Platform Notebooks** - your development experimentation environment
- **Cloud Storage** - a GCS bucket for managing ML artifacts
- **Kubeflow Pipelines** - a lightweight deployment of Kubeflow Pipelines on GKE hosting ML Pipelines and ML Metadata services. GKE will also be used as a primary execution environment for KFP and TFX components.
- **Cloud Build** - CI/CD
- **Container Registry** - a registry for container images encapsulating pipeline components


In the lab environment, all services are provisioned in the same [Google Cloud Project](https://cloud.google.com/storage/docs/projects). 


## Provisioning the lab environment
Before proceeding make sure that you have access to a GCP project. Your account must be the project's **Owner**.

You will run the setup script from [Cloud Shell](https://cloud.google.com/shell/).

To provision the lab environment

1. Open **Cloud Shell**
2. Clone this repo under the `home` folder.
```
cd ~
git clone https://github.com/jarokaz/mlops-miniworkshop.git
cd mlops-miniworkshop/lab-00-environment-setup-automated
```

3. Start installation
```
./install.sh $PROJECT_ID 
```
By default, the script uses the [PROJECT_ID]-[RESOURCE-NAME] format to name the provisioned resources. For example, if your project's ID was `mlops-workshop` the script would provision the resources with the following names:
- `mlops-workshop-notebook` - The AI Platform Notebook instance
- `mlops-workshop-cluster` - The GKE cluster to host KFP services
- `mlops-artifact-store` - The GCS bucket for artifact storage.

If you want to use a different prefix than the project ID, provide it as the second parameter to the `install.sh` script.

By default, all zonal resources are provisioned in the `us-central1-a` zone. Although not recommened, you can use another zone by providing the zone's name as the third parameter to the `install.sh` script.

By default, the KFP services are deployed into the `kubeflow` namespace on the GKE cluster. Currently, you cannot change the namespace name.


4. Review the logs generated by the script for any errors.

## Accessing KFP UI

After the installation completes, you can access the KFP UI from the following URL. You may need to wait a few minutes before the URL is operational.

```
gcloud container clusters get-credentials $PREFIX-cluster --zone $ZONE
echo "https://"$(kubectl describe configmap inverse-proxy-config -n kubeflow | \
grep "googleusercontent.com")
```
